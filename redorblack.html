<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Red or Black Roulette</title>
<style>
  body { margin:0; background:#071021; display:flex; flex-direction:column; align-items:center; font-family:monospace; color:#fff; height:100vh; justify-content:center;}
  canvas { background:#071021; border-radius:12px; box-shadow:0 12px 40px rgba(0,0,0,0.7); display:block; margin:20px 0;}
  #controls { margin-top:8px; display:flex; gap:8px; align-items:center; }
  button { padding:6px 14px; border-radius:8px; cursor:pointer; font-weight:800; }
  #redBtn { background:#ff4d4d; color:#fff; }
  #blackBtn { background:#222; color:#fff; }
  #spin { background:#0f766e; color:#fff; }
  #reset { background:#2b2b2b; color:#fff; }
  #info { margin-top:10px; font-size:14px; color:#ffd66b; }
  #history { margin-top:6px; font-size:12px; color:#9aa6b2; max-height:120px; overflow-y:auto; text-align:left; width:300px; }
</style>
</head>
<body>

<div id="info">
  Chips: <span id="chips">50</span> | Max 200
</div>
<div id="controls">
  <button id="redBtn">Red</button>
  <button id="blackBtn">Black</button>
  <button id="spin" disabled>SPIN</button>
  <button id="reset">RESET</button>
</div>
<canvas id="wheel" width="500" height="500"></canvas>
<div id="history">History:</div>

<script>
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const width = canvas.width, height = canvas.height;
const radius = width/2 - 20;
const slots = 36; // 18 red, 18 black alternating
let ballAngle = 0, spinning = false;
let selectedColor = null;
const STORAGE_KEY='redblack.roulette.v2';
let chips = 50, history = [];
let unlockTime = 0;

// Load storage
try {
  const stored = JSON.parse(localStorage.getItem(STORAGE_KEY));
  chips = stored?.chips || 50;
  history = stored?.history || [];
  unlockTime = stored?.unlockTime || 0;
} catch{}
document.getElementById('chips').innerText = chips;

// Buttons
const redBtn = document.getElementById('redBtn');
const blackBtn = document.getElementById('blackBtn');
const spinBtn = document.getElementById('spin');

function selectColor(color){
    if(spinning) return;
    selectedColor=color;
    redBtn.style.outline = color==='red'?'3px solid #ffd66b':'none';
    blackBtn.style.outline = color==='black'?'3px solid #ffd66b':'none';
    spinBtn.disabled=false;
}
redBtn.addEventListener('click', ()=>selectColor('red'));
blackBtn.addEventListener('click', ()=>selectColor('black'));

// Draw wheel in table perspective
function drawWheel(){
    ctx.clearRect(0,0,width,height);
    const center = {x:width/2, y:height/2 + 30};
    const perspective = 0.6; 
    for(let i=0;i<slots;i++){
        const start = i*(2*Math.PI/slots);
        const end = (i+1)*(2*Math.PI/slots);
        ctx.beginPath();
        ctx.moveTo(center.x, center.y);
        ctx.ellipse(center.x, center.y, radius, radius*perspective, 0, start, end);
        ctx.fillStyle = i%2===0?'#ff4d4d':'#222';
        ctx.fill();
        ctx.strokeStyle='#111'; ctx.stroke();
    }
    // Ball
    const ballR=12;
    const ballX=center.x + Math.cos(ballAngle)*(radius-30);
    const ballY=center.y + Math.sin(ballAngle)*(radius-30)*perspective;
    const grad=ctx.createRadialGradient(ballX,ballY,2,ballX,ballY,ballR);
    grad.addColorStop(0,'#fff2b2'); grad.addColorStop(0.5,'#ffd66b'); grad.addColorStop(1,'#ff8c00');
    ctx.fillStyle=grad;
    ctx.beginPath(); ctx.arc(ballX,ballY,ballR,0,Math.PI*2); ctx.fill();
    // Center circle
    ctx.beginPath(); ctx.arc(center.x, center.y, 20, 0, Math.PI*2); ctx.fillStyle='#071021'; ctx.fill();
}

// Update history
function updateHistory(){
    const hEl=document.getElementById('history');
    hEl.innerHTML='History:<br>';
    history.slice(0,10).forEach(h=>{
        hEl.innerHTML+=`[${h.color}] Bet:${h.bet} â†’ ${h.win?'+':''}${h.result}<br>`;
    });
}

// Spin logic
spinBtn.addEventListener('click', ()=>{
    if(spinning || !selectedColor) return;
    
    const now = Date.now();
    if(unlockTime>now){
        alert('Game locked until next day!');
        return;
    }

    let bet = Math.min(10,chips); // fixed bet for simplicity
    chips -= bet;
    document.getElementById('chips').innerText = chips;
    
    // Decide result with ~35% chance to win
    const winChance = 0.35;
    const win = Math.random()<winChance;
    const finalColor = win?selectedColor:(selectedColor==='red'?'black':'red');
    const targetSlot = finalColor==='red' ? Math.floor(Math.random()*18)*2 : Math.floor(Math.random()*18)*2+1;

    // Animate ball clockwise slowly
    const startAngle = ballAngle;
    const spinDur = 4000 + Math.random()*2000;
    const startTime = performance.now();
    spinning = true;
    function animate(now){
        const t = (now-startTime)/spinDur;
        const ease = 1 - Math.pow(1-t,3);
        ballAngle = startAngle + ease*((targetSlot*2*Math.PI/slots)-startAngle);
        drawWheel();
        if(t<1) requestAnimationFrame(animate);
        else finish();
    }

    function finish(){
        const result = win?bet*2:0;
        if(win) chips += result;
        if(chips>=200) { chips=200; spinBtn.disabled=true; }
        if(chips<=0) { chips=0; spinBtn.disabled=true; }
        document.getElementById('chips').innerText = chips;
        history.unshift({color:finalColor,bet,win,result});
        history=history.slice(0,200);
        updateHistory();
        // lock until same time next day
        unlockTime = Date.now() + 24*60*60*1000;
        localStorage.setItem(STORAGE_KEY, JSON.stringify({chips,history,unlockTime}));
        spinning=false;
        spinBtn.disabled=true;
        selectedColor=null;
        redBtn.style.outline='none';
        blackBtn.style.outline='none';
    }
    requestAnimationFrame(animate);
});

// Reset
document.getElementById('reset').addEventListener('click',()=>{
    chips=50; history=[]; spinning=false; selectedColor=null;
    unlockTime=0;
    document.getElementById('chips').innerText=chips;
    spinBtn.disabled=true;
    redBtn.style.outline='none';
    blackBtn.style.outline='none';
    localStorage.removeItem(STORAGE_KEY);
    updateHistory();
});

// Initial draw
drawWheel();
updateHistory();
</script>

</body>
</html>
