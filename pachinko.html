// Physics
function simulatePhysics(dt){
  if(!ball) return;
  const g = 200;          // Gravity, lowered from 400
  ball.vy += g * dt;      // Update vertical speed
  ball.vx *= 0.995;       // Slight friction
  ball.vy *= 0.995;       // Slight damping
  ball.x += ball.vx * dt * 15;  // Slow down horizontal movement
  ball.y += ball.vy * dt * 15;  // Slow down vertical movement

  // Wall collisions
  if(ball.x-ball.r < 0){ ball.x=ball.r; ball.vx=Math.abs(ball.vx)*0.6; }
  if(ball.x+ball.r > width){ ball.x=width-ball.r; ball.vx=-Math.abs(ball.vx)*0.6; }

  // Peg collisions
  for(const p of pegs){
    const dx=ball.x-p.x, dy=ball.y-p.y;
    const dist=Math.sqrt(dx*dx + dy*dy), minD=ball.r+p.r;
    if(dist<minD && dist>0){
      const nx=dx/dist, ny=dy/dist, rel=ball.vx*nx+ball.vy*ny;
      ball.vx -= 1*rel*nx;
      ball.vy -= 1*rel*ny;
      ball.vx += (Math.random()-0.5)*1;
      ball.y -= 0.2;
      plink(700-(p.y/height)*300,0.03);
    }
  }

  // Slot landing
  if(ball.y+ball.r >= height-80){
    const idx=Math.floor(ball.x/(width/slotCount));
    ball.x = idx*width/slotCount + width/slotCount/2;
    ball.y = height-80-ball.r;
    ball.vx=0; ball.vy=0; dropping=false;
    addPoints(idx);
  }
}
