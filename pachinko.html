<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pachinko Simulator</title>
<style>
  body { margin:0; background:#071021; display:flex; justify-content:center; align-items:center; height:100vh; color:#fff; font-family:monospace; }
  #container { text-align:center; }
  canvas { border-radius:10px; box-shadow:0 12px 40px rgba(0,0,0,0.7); display:block; margin:auto; background:#0c1223; }
  button { padding:8px 14px; border-radius:8px; font-weight:800; margin:0 4px; cursor:pointer; }
  #drop { background:#0f766e; color:#fff; }
  #reset { background:#2b2b2b; color:#fff; }
</style>
</head>
<body>
<div id="container">
  <div style="color:#ffd66b; font-weight:800; margin-bottom:8px;">Total Points (Max 200)</div>
  <div id="total" style="font-size:28px; margin-bottom:12px;">0</div>
  <canvas id="pachinko" width="640" height="840"></canvas>
  <div style="margin-top:12px;">
    <button id="drop">DROP</button>
    <button id="reset">RESET POINTS</button>
  </div>
  <div id="last" style="color:#9aa6b2; margin-top:10px; font-size:13px;">Last: —</div>
</div>

<script>
const canvas = document.getElementById('pachinko');
const ctx = canvas.getContext('2d');
const width = canvas.width, height = canvas.height;
const rows = 12, slotCount = rows + 1;
let displayTotal = 0, ball = null, dropping=false;

// Ball physics function with slower fall
function simulatePhysics(dt){
  if(!ball) return;
  const g = 200;
  ball.vy += g * dt;
  ball.vx *= 0.995;
  ball.vy *= 0.995;
  ball.x += ball.vx * dt * 15;
  ball.y += ball.vy * dt * 15;

  // Wall collisions
  if(ball.x-ball.r<0){ball.x=ball.r; ball.vx=Math.abs(ball.vx)*0.6;}
  if(ball.x+ball.r>width){ball.x=width-ball.r; ball.vx=-Math.abs(ball.vx)*0.6;}

  // Slot landing
  if(ball.y+ball.r >= height-80){
    const idx=Math.floor(ball.x/(width/slotCount));
    ball.x = idx*width/slotCount + width/slotCount/2;
    ball.y = height-80-ball.r;
    ball.vx=0; ball.vy=0; dropping=false;
    displayTotal = Math.min(200, displayTotal + 10);
    document.getElementById('total').innerText = displayTotal;
    document.getElementById('last').innerText = `Last: 10 pts (slot ${idx})`;
  }
}

// Render
function render(){
  ctx.fillStyle="#0c1223";
  ctx.fillRect(0,0,width,height);
  if(ball){
    ctx.beginPath();
    ctx.fillStyle="#ffd66b";
    ctx.arc(ball.x,ball.y,10,0,Math.PI*2);
    ctx.fill();
  }
  if(dropping) requestAnimationFrame(render);
}

// Drop button
document.getElementById('drop').addEventListener('click', ()=>{
  if(dropping || displayTotal>=200) return;
  ball={x:width/2, y:28, vx:(Math.random()-0.5)*6, vy:0, r:10};
  dropping=true;
  const last={t:performance.now()};
  function step(now){
    const dt=Math.min(32,now-last.t)/1000; last.t=now;
    simulatePhysics(dt); render();
    if(dropping) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
});

// Reset button
document.getElementById('reset').addEventListener('click', ()=>{
  displayTotal=0; ball=null; dropping=false;
  document.getElementById('total').innerText=displayTotal;
  document.getElementById('last').innerText='Last: —';
  ctx.fillStyle="#0c1223"; ctx.fillRect(0,0,width,height);
});
</script>
</body>
</html>
