<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slot Machine</title>
<style>
body {
  margin:0; background:#071021; display:flex; flex-direction:column;
  align-items:center; justify-content:center; font-family:monospace; color:#fff; height:100vh;
}
#machine { width:400px; height:360px;
  background:linear-gradient(#333,#111); border-radius:30px; box-shadow:0 12px 40px rgba(0,0,0,0.8);
  padding:20px; display:flex; flex-direction:column; align-items:center; }
#screen { width:360px; height:200px; background:#222; border:4px solid #555; border-radius:12px;
  display:flex; justify-content:space-between; padding:10px; box-shadow:inset 0 0 20px #000; overflow:hidden;}
.reel { width:100px; height:180px; background:#111; border-radius:10px; overflow:hidden;
  border:2px solid #333; display:flex; flex-direction:column; align-items:center; position:relative; }
.symbol { width:100%; height:60px; text-align:center; line-height:60px; font-size:48px; font-weight:800; }
#controls { margin-top:12px; display:flex; flex-direction:column; align-items:center; gap:8px; }
button { padding:10px 20px; border-radius:10px; cursor:pointer; font-weight:800; font-size:16px; background:#0f766e; color:#fff; border:none; }
#info { margin-top:12px; font-size:16px; color:#ffd66b; text-align:center; }
#jackpot { font-size:14px; color:#ff8c00; margin-top:4px; }
.flash { animation:flashAnim 0.5s ease infinite; }
@keyframes flashAnim { 0%,100%{background-color:yellow;} 50%{background-color:transparent;} }
</style>
</head>
<body>

<div id="machine">
  <div id="screen">
    <div class="reel" id="reel0"></div>
    <div class="reel" id="reel1"></div>
    <div class="reel" id="reel2"></div>
  </div>
</div>

<div id="controls">
  <button id="spinBtn">SPIN</button>
</div>

<div id="info">Points: <span id="points">100</span> | Cost: 25 per spin</div>
<div id="jackpot">Jackpot: <span id="jackpotVal">100</span></div>

<script>
const STORAGE_KEY='slot.machine.button.v1';
let points=100,jackpot=100,lockedUntil=0,spinning=false;
const symbols=['üçí','üçã','üçä','‚≠ê','üíé','7Ô∏è‚É£'];
const reels=[document.getElementById('reel0'),document.getElementById('reel1'),document.getElementById('reel2')];

// Load storage
try{
  const stored=JSON.parse(localStorage.getItem(STORAGE_KEY));
  points=stored?.points||100;
  jackpot=stored?.jackpot||100;
  lockedUntil=stored?.lockedUntil||0;
}catch{}
updateDisplay();
checkLock();
initializeReels();

// === AUDIO ===
let audioCtx;
function ensureAudio(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();return audioCtx;}
function playSound(freq,dur){const ctx=ensureAudio(); if(!ctx)return;
const o=ctx.createOscillator(),g=ctx.createGain(); o.frequency.value=freq; o.connect(g); g.connect(ctx.destination); g.gain.value=0.08;
o.start(); g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+dur); o.stop(ctx.currentTime+dur+0.05);}

// === DISPLAY ===
function updateDisplay(){ document.getElementById('points').innerText=points; document.getElementById('jackpotVal').innerText=jackpot; }
function saveState(){ localStorage.setItem(STORAGE_KEY,JSON.stringify({points,jackpot,lockedUntil})); }

// === LOCK SYSTEM ===
function checkLock(){
  const now=Date.now();
  if(now<lockedUntil){
    spinning=true;
    document.getElementById('spinBtn').disabled=true;
    const remaining=Math.ceil((lockedUntil-now)/1000);
    document.getElementById('info').innerText=`LOCKED! Come back in ${remaining}s`;
    setTimeout(checkLock,1000);
  }else{
    spinning=false;
    document.getElementById('spinBtn').disabled=false;
    document.getElementById('info').innerText=`Points: ${points} | Cost: 25 per spin`;
  }
}

// === INITIALIZE REELS ===
function initializeReels(){
  reels.forEach(reel=>{
    reel.innerHTML='';
    for(let i=0;i<3;i++){
      const sym=document.createElement('div'); sym.className='symbol';
      sym.innerText=symbols[Math.floor(Math.random()*symbols.length)];
      reel.appendChild(sym);
    }
  });
}

// === SPIN FUNCTION ===
function spinReelAnimated(reel,duration=2000){
  return new Promise(resolve=>{
    const startTime=performance.now();
    const finalSymbol=symbols[Math.floor(Math.random()*symbols.length)];
    function animate(){
      const now=performance.now();
      const t=(now-startTime)/duration;
      reel.innerHTML='';
      for(let i=0;i<3;i++){
        const sym=document.createElement('div'); sym.className='symbol';
        sym.innerText = t<0.8 ? symbols[Math.floor(Math.random()*symbols.length)] : finalSymbol;
        reel.appendChild(sym);
      }
      playSound(300+Math.random()*200,0.03);
      if(t<1) requestAnimationFrame(animate);
      else resolve(finalSymbol);
    }
    requestAnimationFrame(animate);
  });
}

// === START SPIN ===
async function startSpin(){
  if(spinning || points<25) return;
  points-=25; updateDisplay(); spinning=true;

  const results=[];
  for(let i=0;i<3;i++) results.push(await spinReelAnimated(reels[i]));

  const allMatch=results.every(s=>s===results[0]);
  const winPoints=allMatch?jackpot:Math.floor(Math.random()*20)+5;
  points+=winPoints;

  if(allMatch){
    jackpot=Math.floor(jackpot*1.5);
    points=500;
    lockedUntil=Date.now()+24*60*60*1000;
    flashReels();
    checkLock();
    playSound(1000,0.5);
  }else{
    jackpot+=10;
    playSound(300,0.15);
  }

  updateDisplay();
  saveState();
  spinning=false;
}

function flashReels(){ reels.forEach(r=>r.classList.add('flash')); setTimeout(()=>reels.forEach(r=>r.classList.remove('flash')),1000); }

// === BUTTON EVENT ===
document.getElementById('spinBtn').addEventListener('click',startSpin);
</script>
</body>
</html>
