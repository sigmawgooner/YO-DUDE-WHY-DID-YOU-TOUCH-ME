<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slot Machine</title>
<style>
  body { 
    margin:0; background:#071021; color:#fff; font-family:monospace; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh;
  }
  canvas { 
    background:#0b1a2f; border-radius:16px; box-shadow:0 12px 40px rgba(0,0,0,0.7); 
  }
  #controls { margin-top:16px; display:flex; gap:12px; align-items:center; }
  button { padding:8px 16px; font-weight:800; border-radius:8px; cursor:pointer; }
  #spin { background:#0f766e; color:#fff; }
  #info { margin-top:12px; font-size:16px; color:#ffd66b; text-align:center; }
</style>
</head>
<body>
<canvas id="slots" width="360" height="300"></canvas>
<div id="controls">
  <button id="spin">SPIN (25 chips)</button>
  <button id="reset">RESET</button>
</div>
<div id="info">Chips: <span id="chips">100</span> | Jackpot: <span id="jackpot">50</span></div>

<script>
const canvas = document.getElementById('slots');
const ctx = canvas.getContext('2d');
const width = canvas.width, height = canvas.height;
const reelCount = 3;
const symbols = ['üçí','üçã','üçä','üçâ','‚≠ê','üíé']; // classic emoji symbols
const symbolHeight = 80;
const spinCost = 25;
const maxChips = 500;
const STORAGE_KEY='slotmachine.session.v1';
let reels=[], spinning=false;
let chips=100, jackpot=50;
let lastWinTime = null;

// Load saved data
try {
  const stored = JSON.parse(localStorage.getItem(STORAGE_KEY));
  chips = stored?.chips || 100;
  jackpot = stored?.jackpot || 50;
  lastWinTime = stored?.lastWinTime || null;
} catch{}
document.getElementById('chips').innerText=chips;
document.getElementById('jackpot').innerText=jackpot;

// 24-hour lock check
function isLocked() {
  if(!lastWinTime) return false;
  const next = new Date(lastWinTime);
  next.setHours(next.getHours()+24);
  return new Date() < next;
}

// Initialize reels
for(let i=0;i<reelCount;i++){
  reels.push({pos:0,vel:0,target:0});
}

// Draw reels
function draw(){
  ctx.clearRect(0,0,width,height);
  const reelWidth = width/reelCount;
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  ctx.font = symbolHeight+'px sans-serif';
  for(let i=0;i<reelCount;i++){
    const r=reels[i];
    const yOffset = r.pos%symbolHeight;
    for(let j=-1;j<=symbols.length;j++){
      const sym = symbols[(j+symbols.length)%symbols.length];
      const y = height/2 + (j)*symbolHeight - yOffset;
      ctx.fillText(sym, i*reelWidth + reelWidth/2, y);
    }
    // Reel separator
    ctx.strokeStyle='#222';
    ctx.lineWidth=4;
    ctx.beginPath();
    ctx.moveTo((i+1)*reelWidth,0); ctx.lineTo((i+1)*reelWidth,height); ctx.stroke();
  }
}

// Spin animation
function spin(){
  if(spinning) return;
  if(isLocked()) { alert("You reached 500 chips! Come back in 24 hours."); return; }
  if(chips<spinCost) { alert("Not enough chips!"); return; }
  spinning=true;
  chips -= spinCost;
  document.getElementById('chips').innerText=chips;

  // Decide result
  const results = [];
  for(let i=0;i<reelCount;i++){
    const symIndex = Math.floor(Math.random()*symbols.length);
    results.push(symIndex);
  }

  // Make it slightly unfair: 35% chance all symbols match if player expects
  if(Math.random()<0.35){
    const common = Math.floor(Math.random()*symbols.length);
    for(let i=0;i<reelCount;i++) results[i]=common;
  }

  // Set target position
  for(let i=0;i<reelCount;i++){
    reels[i].target = results[i]*symbolHeight + symbolHeight*3 + Math.random()*symbolHeight; // add extra spins
    reels[i].vel = 0;
  }

  const deceleration = 0.05;

  function animate(){
    let done=true;
    for(let i=0;i<reelCount;i++){
      const r=reels[i];
      const diff = r.target - r.pos;
      if(Math.abs(diff)>0.5){
        done=false;
        r.vel += diff*0.2;
        r.vel *= 0.9;
        r.pos += r.vel;
      } else {
        r.pos = r.target;
      }
    }
    draw();
    if(!done) requestAnimationFrame(animate);
    else finish(results);
  }
  requestAnimationFrame(animate);
}

// Finish spin
function finish(results){
  let win=false;
  if(results.every(v=>v===results[0])) win=true;
  let winAmount=0;
  if(win){
    winAmount = jackpot;
    chips += jackpot;
    jackpot = 50;
    lastWinTime = new Date().toISOString();
  } else {
    jackpot += 10;
    chips = Math.max(chips, spinCost); // give enough to spin again if lost
  }
  document.getElementById('chips').innerText=chips;
  document.getElementById('jackpot').innerText=jackpot;
  localStorage.setItem(STORAGE_KEY, JSON.stringify({chips,jackpot,lastWinTime}));
  spinning=false;
  if(chips>=maxChips){ alert("You hit the max! Come back tomorrow."); }
}

// Button events
document.getElementById('spin').addEventListener('click', spin);
document.getElementById('reset').addEventListener('click',()=>{
  chips=100; jackpot=50; lastWinTime=null;
  document.getElementById('chips').innerText=chips;
  document.getElementById('jackpot').innerText=jackpot;
  localStorage.removeItem(STORAGE_KEY);
  draw();
});

// Initial draw
draw();
</script>
</body>
</html>
