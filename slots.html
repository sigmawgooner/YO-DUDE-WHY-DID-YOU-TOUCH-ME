<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slot Machine</title>
<style>
body {
  margin:0;
  background:#071021;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-family:monospace;
  color:#fff;
  height:100vh;
}
#machine {
  position:relative;
  width:400px;
  height:520px;
  background:linear-gradient(#333,#111);
  border-radius:30px;
  box-shadow:0 12px 40px rgba(0,0,0,0.8);
  padding:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
}
#screen {
  width:360px;
  height:220px;
  background:#222;
  border:4px solid #555;
  border-radius:12px;
  display:flex;
  justify-content:space-between;
  padding:10px;
  box-shadow:inset 0 0 20px #000;
}
.reel {
  width:100px;
  height:200px;
  background:#111;
  border-radius:10px;
  overflow:hidden;
  border:2px solid #333;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  position:relative;
}
.symbol {
  width:100%;
  height:80px;
  text-align:center;
  line-height:80px;
  font-size:48px;
  font-weight:800;
  border-bottom:1px solid #333;
}
#lever-container {
  position:absolute;
  right:-60px;
  top:50px;
  width:50px;
  height:200px;
  display:flex;
  justify-content:center;
  align-items:flex-start;
}
#lever {
  width:40px;
  height:120px;
  background:#0f766e;
  border-radius:20px;
  cursor:pointer;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  color:#fff;
  font-weight:800;
  user-select:none;
  text-align:center;
  line-height:120px;
  font-size:24px;
  touch-action:none;
  transition: transform 0.1s ease;
}
#info {
  margin-top:12px;
  font-size:16px;
  color:#ffd66b;
  text-align:center;
}
#jackpot {
  font-size:14px;
  color:#ff8c00;
  margin-top:4px;
}
.flash {
  animation:flashAnim 0.5s ease infinite;
}
@keyframes flashAnim {
  0%,100%{background-color:yellow;}
  50%{background-color:transparent;}
}
</style>
</head>
<body>

<div id="machine">
  <div id="screen">
    <div class="reel" id="reel0"></div>
    <div class="reel" id="reel1"></div>
    <div class="reel" id="reel2"></div>
  </div>
  <div id="lever-container">
    <div id="lever">‚õì</div>
  </div>
</div>

<div id="info">Points: <span id="points">100</span> | Cost: 25 per spin</div>
<div id="jackpot">Jackpot: <span id="jackpotVal">100</span></div>

<script>
const STORAGE_KEY='slot.machine.v5';
let points=100,jackpot=100,lockedUntil=0,spinning=false;
const symbols=['üçí','üçã','üçä','‚≠ê','üíé','7Ô∏è‚É£'];
const reels=[document.getElementById('reel0'),document.getElementById('reel1'),document.getElementById('reel2')];

// Load storage
try{
  const stored=JSON.parse(localStorage.getItem(STORAGE_KEY));
  points=stored?.points||100;
  jackpot=stored?.jackpot||100;
  lockedUntil=stored?.lockedUntil||0;
}catch{}
updateDisplay();
checkLock();
initializeReels();

// === AUDIO ===
let audioCtx;
function ensureAudio(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();return audioCtx;}
function playSound(freq,dur){
  const ctx=ensureAudio(); if(!ctx)return;
  const o=ctx.createOscillator(),g=ctx.createGain();
  o.frequency.value=freq; o.connect(g); g.connect(ctx.destination); g.gain.value=0.08;
  o.start(); g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+dur); o.stop(ctx.currentTime+dur+0.05);
}

// === DISPLAY ===
function updateDisplay(){
  document.getElementById('points').innerText=points;
  document.getElementById('jackpotVal').innerText=jackpot;
}
function saveState(){
  localStorage.setItem(STORAGE_KEY,JSON.stringify({points,jackpot,lockedUntil}));
}

// === LOCK SYSTEM ===
function checkLock(){
  const now=Date.now();
  if(now<lockedUntil){
    spinning=true;
    document.getElementById('lever').style.pointerEvents='none';
    const remaining=Math.ceil((lockedUntil-now)/1000);
    document.getElementById('info').innerText=`LOCKED! Come back in ${remaining}s`;
    setTimeout(checkLock,1000);
  }else{
    spinning=false;
    document.getElementById('lever').style.pointerEvents='auto';
    document.getElementById('info').innerText=`Points: ${points} | Cost: 25 per spin`;
  }
}

// === INITIALIZE REELS ===
function initializeReels(){
  reels.forEach(reel=>{
    reel.innerHTML='';
    for(let i=0;i<3;i++){
      const sym=document.createElement('div');
      sym.className='symbol';
      sym.innerText=symbols[Math.floor(Math.random()*symbols.length)];
      reel.appendChild(sym);
    }
  });
}

// === REEL SPINNING ===
function spinReel(reel){
  return new Promise(resolve=>{
    const totalSymbols = symbols.length;
    let pos=Math.floor(Math.random()*totalSymbols);
    const spins=30+Math.floor(Math.random()*20);
    const stepTime=80+Math.random()*40;
    let count=0;
    const interval=setInterval(()=>{
      reel.innerHTML='';
      for(let i=0;i<3;i++){
        const sym=document.createElement('div');
        sym.className='symbol';
        sym.innerText=symbols[(pos+i)%totalSymbols];
        reel.appendChild(sym);
      }
      pos=(pos+1)%totalSymbols;
      playSound(400+(pos*40),0.05);
      count++;
      if(count>=spins){ clearInterval(interval); bounceReel(reel); resolve(symbols[pos]); }
    }, stepTime);
  });
}

function bounceReel(reel){
  reel.style.transition='transform 0.2s';
  reel.style.transform='translateY(-10px)';
  setTimeout(()=>{ reel.style.transform='translateY(0)'; },200);
}

// === LEVER DRAG ===
const lever=document.getElementById('lever');
let dragging=false,startY=0;
lever.addEventListener('pointerdown',e=>{
  if(spinning) return;
  dragging=true;
  startY=e.clientY;
  lever.setPointerCapture(e.pointerId);
});
lever.addEventListener('pointermove',e=>{
  if(!dragging) return;
  let deltaY=e.clientY-startY;
  if(deltaY>80) deltaY=80;
  if(deltaY<0) deltaY=0;
  lever.style.transform=`translateY(${deltaY}px) rotate(${deltaY/4}deg)`;
});
lever.addEventListener('pointerup',async e=>{
  if(!dragging) return;
  dragging=false;
  lever.style.transform='translateY(0px) rotate(0deg)';
  startSpin();
});

// === START SPIN ===
async function startSpin(){
  if(spinning) return;
  if(points<25) return;
  points-=25; updateDisplay();
  spinning=true;

  const results=[];
  for(let i=0;i<3;i++) results.push(await spinReel(reels[i]));

  const allMatch=results.every(s=>s===results[0]);
  const winPoints=allMatch?jackpot:Math.floor(Math.random()*20)+5;
  points+=winPoints;

  if(allMatch){
    jackpot=Math.floor(jackpot*1.5);
    points=500;
    lockedUntil=Date.now()+24*60*60*1000;
    flashReels();
    checkLock();
    playSound(1000,0.5);
  }else{
    jackpot+=10;
    playSound(300,0.15);
  }

  updateDisplay();
  saveState();
  spinning=false;
}

function flashReels(){
  reels.forEach(r=>r.classList.add('flash'));
  setTimeout(()=>reels.forEach(r=>r.classList.remove('flash')),1000);
}
</script>

</body>
</html>
